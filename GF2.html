<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoFootball</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background-color: #87ceeb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 1200px;
            background-color: #228b22;
            border: 5px solid #fff;
            box-sizing: border-box;
            overflow: hidden;
        }

        #field {
            position: absolute;
            top: 10%;
            left: 5%;
            width: 90%;
            height: 80%;
            background-color: #2e8b57;
            border: 3px solid #fff;
            border-radius: 10px;
            z-index: 0;
        }

        .player {
            position: absolute;
            width: 40px;
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            image-rendering: pixelated;
            z-index: 10;
        }

        .player-head {
            width: 16px;
            height: 16px;
            background-color: #ffd700;
            border: 2px solid #000;
            border-radius: 50%;
        }

        .player-body {
            width: 24px;
            height: 24px;
            background-color: #1e90ff;
            border: 2px solid #000;
        }

        .player-feet {
            width: 24px;
            height: 12px;
            background-color: #ff4500;
            border: 2px solid #000;
            border-radius: 0 0 4px 4px;
        }

        #player1 {
            bottom: 0px; /* At field base */
            left: 50%;
            transform: translateX(-50%);
        }

        #player2 {
            display: none;
        }

        #ball {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #fff 0%, #fff 70%, #000 71%, #000 75%, #fff 76%);
            background-size: 5px 5px;
            border-radius: 50%;
            bottom: 10px; /* Under player1's feet */
            left: 50%;
            transform: translateX(-50%);
            z-index: 9;
        }

        @keyframes roll {
            from { transform: translateX(-50%) rotate(0deg); }
            to { transform: translateX(-50%) rotate(360deg); }
        }

        #goal {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 50px;
            background-color: #fff;
            border: 3px solid #000;
            z-index: 2;
        }

        #audience-left, #audience-right {
            position: absolute;
            top: 10%;
            height: 80%;
            width: 4%;
            background: radial-gradient(circle at 5px 5px, #ff0000 2px, #0000 3px),
                        radial-gradient(circle at 10px 10px, #00ff00 2px, #0000 3px),
                        radial-gradient(circle at 15px 15px, #0000ff 2px, #0000 3px),
                        radial-gradient(circle at 20px 20px, #ffff00 2px, #0000 3px);
            background-size: 20px 20px;
            z-index: 1;
        }

        #audience-left {
            left: 1%;
        }

        #audience-right {
            right: 1%;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 20px;
            text-shadow: 2px 2px #000;
            z-index: 15;
        }

        #angle-input {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px;
            font-size: 18px;
            width: 100px;
            border: 2px solid #000;
            border-radius: 5px;
            z-index: 15;
        }

        #pass-button {
            position: absolute;
            bottom: 10px;
            left: 60%;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #ffd700;
            border: 2px solid #000;
            border-radius: 5px;
            cursor: pointer;
            z-index: 15;
        }

        #next-button {
            position: absolute;
            bottom: 10px;
            left: 60%;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #32cd32;
            border: 2px solid #000;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            z-index: 15;
        }

        #feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            color: #fff;
            text-shadow: 2px 2px #000;
            display: none;
            z-index: 15;
        }

        #modal, #game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #game-over {
            display: none;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        #branding {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: #fff;
            font-size: 18px;
            text-shadow: 1px 1px #000;
            z-index: 1000;
        }

        #trajectory {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 8;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="field">
            <div id="player1" class="player">
                <div class="player-head"></div>
                <div class="player-body"></div>
                <div class="player-feet"></div>
            </div>
            <div id="player2" class="player">
                <div class="player-head"></div>
                <div class="player-body"></div>
                <div class="player-feet"></div>
            </div>
            <div id="ball"></div>
            <div id="goal"></div>
        </div>
        <div id="audience-left"></div>
        <div id="audience-right"></div>
        <svg id="trajectory"></svg>
        <div id="ui">Player: <span id="player-name"></span> | Score: <span id="score">0</span> | Misses: <span id="misses">0</span></div>
        <input type="number" id="angle-input" placeholder="Enter angle" min="0" max="180">
        <button id="pass-button">Pass</button>
        <button id="next-button">Next Round</button>
        <div id="feedback"></div>
    </div>
    <div id="modal">
        <div class="modal-content">
            <h2>Welcome to GeoFootball!</h2>
            <p>Learn angles by kicking the ball from the player's center at the base. Enter angles anticlockwise (0° right, 90° up, 180° left). ±5° tolerance.</p>
            <input type="text" id="name-input" placeholder="Enter your name">
            <button id="start-button">Start Game</button>
        </div>
    </div>
    <div id="game-over">
        <div class="modal-content">
            <h2>Game Over!</h2>
            <p>Score: <span id="final-score"></span></p>
            <button id="restart-button">Restart</button>
        </div>
    </div>
    <div id="branding">GeoFootball by Rajat</div>

    <script>
        const field = document.getElementById('field');
        const ball = document.getElementById('ball');
        const player1 = document.getElementById('player1');
        const player2 = document.getElementById('player2');
        const goal = document.getElementById('goal');
        const angleInput = document.getElementById('angle-input');
        const passButton = document.getElementById('pass-button');
        const nextButton = document.getElementById('next-button');
        const feedback = document.getElementById('feedback');
        const scoreDisplay = document.getElementById('score');
        const missesDisplay = document.getElementById('misses');
        const playerNameDisplay = document.getElementById('player-name');
        const modal = document.getElementById('modal');
        const nameInput = document.getElementById('name-input');
        const startButton = document.getElementById('start-button');
        const gameOver = document.getElementById('game-over');
        const finalScore = document.getElementById('final-score');
        const restartButton = document.getElementById('restart-button');
        const trajectorySvg = document.getElementById('trajectory');

        let score = 0;
        let misses = 0;
        let correctAngle = 0;
        let previousAngle = null;
        let isDirectGoal = false;
        let playerName = '';
        let ballState = { x: 0, y: 0, vx: 0, vy: 0, moving: false, target: null };
        let animationFrameId = null;

        function startGame() {
            playerName = nameInput.value.trim() || 'Player';
            playerNameDisplay.textContent = playerName;
            modal.style.display = 'none';
            startRound();
        }

        function endGame() {
            finalScore.textContent = score;
            gameOver.style.display = 'flex';
            passButton.style.display = 'none';
            nextButton.style.display = 'none';
            angleInput.style.display = 'none';
            stopBall();
        }

        function restartGame() {
            score = 0;
            misses = 0;
            previousAngle = null;
            scoreDisplay.textContent = score;
            missesDisplay.textContent = misses;
            gameOver.style.display = 'none';
            angleInput.style.display = 'block';
            startRound();
        }

        function startRound() {
            passButton.style.display = 'block';
            nextButton.style.display = 'none';
            feedback.style.display = 'none';
            angleInput.value = '';
            stopBall();

            // Reset ball: under player1's feet at base, visible
            ball.style.bottom = '10px';
            ball.style.left = '50%';
            ball.style.transform = 'translateX(-50%)';
            ball.style.display = 'block';
            ball.style.animation = ''; // Clear animation

            // Reset player1: at field base, centered
            player1.style.bottom = '0px';
            player1.style.left = '50%';
            player1.style.transform = 'translateX(-50%)';
            player1.style.display = 'flex';

            // Log player1 and ball positions
            const player1Rect = player1.getBoundingClientRect();
            const ballRect = ball.getBoundingClientRect();
            console.log(`Player1 center: (${(player1Rect.left + 20).toFixed(0)}, ${(player1Rect.bottom - 30).toFixed(0)})`);
            console.log(`Ball center: (${(ballRect.left + 10).toFixed(0)}, ${(ballRect.bottom - 10).toFixed(0)})`);

            // Set up round: direct goal (10%) or pass to player2
            isDirectGoal = Math.random() < 0.1;
            if (isDirectGoal) {
                correctAngle = 90; // Straight up
                player2.style.display = 'none';
                console.log('Direct goal, correct angle: 90°');
            } else {
                const fieldRect = field.getBoundingClientRect();
                const maxX = fieldRect.width - 40;
                const maxY = fieldRect.height - 60;
                let x, y, angle;
                do {
                    x = Math.random() * (maxX - 100) + 50;
                    y = Math.random() * (maxY / 2);
                    player2.style.left = `${x}px`;
                    player2.style.top = `${y}px`;
                    player2.style.display = 'flex';

                    const player2Rect = player2.getBoundingClientRect();
                    const dx = (player2Rect.left + 20) - (player1Rect.left + 20); // From player1 center
                    const dy = (player1Rect.bottom - 30) - (player2Rect.top + 30); // Up is positive
                    angle = (Math.atan2(dy, dx) * 180 / Math.PI + 360) % 360; // Anticlockwise
                    if (angle > 180) angle = 360 - angle; // Restrict to 0°–180°
                    correctAngle = Math.round(angle);
                } while (
                    Math.abs(correctAngle - 90) < 5 ||
                    correctAngle < 0 ||
                    correctAngle > 180 ||
                    (previousAngle !== null && Math.abs(correctAngle - previousAngle) < 10)
                );
                console.log(`Pass to player2 at (${x.toFixed(0)}, ${y.toFixed(0)}), correct angle: ${correctAngle}°`);
            }
            previousAngle = correctAngle;
        }

        function stopBall() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            ballState.moving = false;
            ballState.vx = 0;
            ballState.vy = 0;
            ballState.target = null;
            ball.style.display = 'block';
            ball.style.animation = ''; // Stop rolling animation
            console.log(`Ball stopped, display: ${ball.style.display}, z-index: ${ball.style.zIndex}`);
        }

        function moveBall() {
            if (!ballState.moving) return;

            const fieldRect = field.getBoundingClientRect();
            const ballRect = ball.getBoundingClientRect();
            const minX = fieldRect.left + 10;
            const maxX = fieldRect.right - 30;
            const minY = fieldRect.bottom + 10;
            const maxY = fieldRect.top - 10;

            ballState.x += ballState.vx;
            ballState.y += ballState.vy;

            let newX = ballState.x + ballRect.left;
            let newY = ballState.y + ballRect.bottom;

            // Clamp to field boundaries
            if (newX < minX) newX = minX;
            if (newX > maxX) newX = maxX;
            if (newY < minY) newY = minY;
            if (newY > maxY) newY = maxY;

            ball.style.left = `${newX}px`;
            ball.style.bottom = `${window.innerHeight - newY - 10}px`;
            ball.style.display = 'block';
            ball.style.animation = 'roll 0.5s linear infinite'; // Apply rolling animation

            const distanceToTarget = ballState.target ? Math.hypot(ballState.target.x - newX, ballState.target.y - newY).toFixed(0) : 'N/A';
            console.log(`Ball position: (${newX.toFixed(0)}, ${newY.toFixed(0)}), display: ${ball.style.display}, z-index: ${ball.style.zIndex}, distance to target: ${distanceToTarget}px`);

            // Stop if at target or boundary
            if (
                ballState.target &&
                (Math.hypot(ballState.target.x - newX, ballState.target.y - newY) < 5 ||
                    newX === minX || newX === maxX || newY === minY || newY === maxY)
            ) {
                ballState.moving = false;
                ball.style.left = `${newX}px`;
                ball.style.bottom = `${window.innerHeight - newY - 10}px`;
                ball.style.display = 'block';
                ball.style.animation = ''; // Stop rolling animation
                console.log(`Ball stopped at target/boundary, display: ${ball.style.display}, z-index: ${ball.style.zIndex}`);
                if (ballState.target.callback) {
                    setTimeout(ballState.target.callback, 300);
                } else {
                    nextButton.style.display = 'block';
                }
                return;
            }

            animationFrameId = requestAnimationFrame(moveBall);
        }

        function drawTrajectory(startX, startY, endX, endY, isHit, secondaryEndX, secondaryEndY) {
            trajectorySvg.innerHTML = '';
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', startX);
            line.setAttribute('y1', startY);
            line.setAttribute('x2', endX);
            line.setAttribute('y2', endY);
            line.setAttribute('stroke', isHit ? '#32cd32' : '#ff4500');
            line.setAttribute('stroke-width', '2');
            line.setAttribute('stroke-dasharray', '5,5');
            trajectorySvg.appendChild(line);

            if (isHit && secondaryEndX !== undefined) {
                const secondaryLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                secondaryLine.setAttribute('x1', endX);
                secondaryLine.setAttribute('y1', endY);
                secondaryLine.setAttribute('x2', secondaryEndX);
                secondaryLine.setAttribute('y2', secondaryEndY);
                secondaryLine.setAttribute('stroke', '#32cd32');
                secondaryLine.setAttribute('stroke-width', '2');
                secondaryLine.setAttribute('stroke-dasharray', '5,5');
                trajectorySvg.appendChild(secondaryLine);
            }

            setTimeout(() => {
                trajectorySvg.innerHTML = '';
            }, 500);
        }

        function passBall() {
            const inputAngle = parseFloat(angleInput.value);
            if (isNaN(inputAngle) || inputAngle < 0 || inputAngle > 180) {
                feedback.textContent = 'Enter an angle between 0 and 180!';
                feedback.style.display = 'block';
                return;
            }

            passButton.style.display = 'none';
            stopBall();
            trajectorySvg.innerHTML = '';

            const isCorrect = Math.abs(inputAngle - correctAngle) <= 5;
            console.log(`Input angle: ${inputAngle}°, Correct angle: ${correctAngle}°, Difference: ${Math.abs(inputAngle - correctAngle)}°`);

            const player1Rect = player1.getBoundingClientRect();
            const ballRect = ball.getBoundingClientRect();
            const startX = player1Rect.left + 20; // Player1 center
            const startY = player1Rect.bottom - 30; // Player1 center
            const fieldRect = field.getBoundingClientRect();
            const goalRect = goal.getBoundingClientRect();
            const goalCenterX = goalRect.left + goalRect.width / 2 - 10;
            const goalCenterY = window.innerHeight - goalRect.bottom - 10;
            const speed = 6;

            console.log(`Goal post: (${goalCenterX.toFixed(0)}, ${goalCenterY.toFixed(0)})`);

            if (isCorrect) {
                score++;
                scoreDisplay.textContent = score;
                feedback.textContent = isDirectGoal ? `Goal! Correct angle: ${correctAngle}°` : `Pass Successful! Correct angle: ${correctAngle}°`;
                feedback.style.color = '#32cd32';
                feedback.style.display = 'block';

                if (isDirectGoal) {
                    drawTrajectory(startX, startY, goalCenterX, window.innerHeight - goalCenterY, true);
                    setTimeout(() => {
                        ballState.x = ballRect.left;
                        ballState.y = ballRect.bottom;
                        ballState.target = { x: goalCenterX, y: window.innerHeight - goalCenterY };
                        const dx = goalCenterX - ballRect.left;
                        const dy = (window.innerHeight - goalCenterY) - ballRect.bottom;
                        const distance = Math.hypot(dx, dy);
                        ballState.vx = (dx / distance) * speed;
                        ballState.vy = (dy / distance) * speed;
                        ballState.moving = true;
                        ball.style.display = 'block';
                        moveBall();
                    }, 500);
                } else {
                    const player2Rect = player2.getBoundingClientRect();
                    const player2X = player2Rect.left + 10;
                    const player2Y = window.innerHeight - player2Rect.top - 30;
                    console.log(`Player2: (${player2X.toFixed(0)}, ${player2Y.toFixed(0)})`);
                    drawTrajectory(startX, startY, player2X, window.innerHeight - player2Y, true, goalCenterX, window.innerHeight - goalCenterY);
                    setTimeout(() => {
                        ballState.x = ballRect.left;
                        ballState.y = ballRect.bottom;
                        ballState.target = {
                            x: player2X,
                            y: window.innerHeight - player2Y,
                            callback: () => {
                                ballState.x = player2X;
                                ballState.y = window.innerHeight - player2Y;
                                ballState.target = { x: goalCenterX, y: window.innerHeight - goalCenterY };
                                const dx = goalCenterX - player2X;
                                const dy = (window.innerHeight - goalCenterY) - (window.innerHeight - player2Y);
                                const distance = Math.hypot(dx, dy);
                                ballState.vx = (dx / distance) * speed;
                                ballState.vy = (dy / distance) * speed;
                                ballState.moving = true;
                                ball.style.display = 'block';
                                moveBall();
                            }
                        };
                        const dx = player2X - ballRect.left;
                        const dy = (window.innerHeight - player2Y) - ballRect.bottom;
                        const distance = Math.hypot(dx, dy);
                        ballState.vx = (dx / distance) * speed;
                        ballState.vy = (dy / distance) * speed;
                        ballState.moving = true;
                        ball.style.display = 'block';
                        moveBall();
                    }, 500);
                }
            } else {
                misses++;
                missesDisplay.textContent = misses;
                feedback.textContent = `Missed! Correct angle: ${correctAngle}°`;
                feedback.style.color = '#ff4500';
                feedback.style.display = 'block';
                if (misses >= 3) {
                    endGame();
                    return;
                }

                const radianAngle = (inputAngle * Math.PI) / 180; // Anticlockwise
                const distance = 200;
                let endX = startX + distance * Math.cos(radianAngle);
                let endY = startY - distance * Math.sin(radianAngle);
                const minX = fieldRect.left + 10;
                const maxX = fieldRect.right - 30;
                const minY = fieldRect.bottom + 10;
                const maxY = fieldRect.top - 10;

                if (endX < minX) endX = minX;
                if (endX > maxX) endX = maxX;
                if (endY < minY) endY = minY;
                if (endY > maxY) endY = maxY;

                drawTrajectory(startX, startY, endX, window.innerHeight - endY, false);
                setTimeout(() => {
                    ballState.x = ballRect.left;
                    ballState.y = ballRect.bottom;
                    ballState.target = { x: endX, y: window.innerHeight - endY };
                    const dx = endX - ballRect.left;
                    const dy = (window.innerHeight - endY) - ballRect.bottom;
                    const dist = Math.hypot(dx, dy);
                    ballState.vx = (dx / dist) * speed;
                    ballState.vy = (dy / dist) * speed;
                    ballState.moving = true;
                    ball.style.display = 'block';
                    moveBall();
                }, 500);
            }
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', restartGame);
        passButton.addEventListener('click', passBall);
        nextButton.addEventListener('click', startRound);
        angleInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') passBall();
        });

        modal.style.display = 'flex';
    </script>
</body>
</html>